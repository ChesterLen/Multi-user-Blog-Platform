{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="profile-container">
        {% if object.petimage_set.first %}
            <div class="banner">
                <img src="{{ object.petimage_set.first.image.url }}" alt="profile banner">
            </div>
        {% else %}
            <div class="empty-banner"></div>
        {% endif %}

        <div class="profile-details">
            {% if object.petimage_set.first %}
                <div class="profile-img">
                    <img src="{{ object.petimage_set.first.image.url }}" alt="profile picture">
                </div>
            {% else %}
                <div class="no-profile-img"></div>
            {% endif %}
            
            <div class="profile-data">
                {% if object.name %}
                    <h3>Name: {{ object.name }} <a href="{% url 'dog_or_cat' %}"><a href="{% url 'dog_or_cat' %}"><i class="fa-solid fa-gear"></i></a></h3>
                {% else %}
                    <h3>Name: <a href="{% url 'dog_or_cat' %}"><i class="fa-solid fa-gear"></i></a></h3>
                {% endif %}

                {% if object.breed %}
                    <p>Breed: {{ object.breed }}</p>
                {% else %}
                    <p>Breed: </p>
                {% endif %}

                <p>
                    <i class="fa-solid fa-user-group"></i> 
                    <a href="{% url 'followers' pk=object.pk %}" id="followers">{{ followers }} followers</a> 
                    <a href="{% url 'following' pk=object.pk %}" id="following">{{ following_pets }} following</a>
                </p>

                {% if following %}
                    <a href="{% url 'unfollow' pk=object.pk %}">Unollow</a>
                {% else %}
                    {% if request.pet.pk != object.pk %}
                        <a href="{% url 'follow' pk=object.pk %}">Follow</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <p>{{ object.description }}</p>
    </div>
    {% if request.pet == object.user.pet %}
        <div class="form-pop-up">
            <p>What's on your mind?</p>
        </div>
    {% endif %}

    {% if publications %}
        <div class="publications">
            {% for publication in publications %}
                <div class="publication-card">

                    <div class="user">
                        {% if object.petimage_set.exists %}
                            <div class="user-img">
                                <img src="{{ object.petimage_set.first.image.url }}" alt="user image">
                            </div>
                        {% else %}
                            <div class="user-img"></div>
                        {% endif %}
                        <p>{{ object.name }}</p>
                    </div>
                    
                    <div class="content">
                        <h4>{{ publication.title }}</h4>
                        <p>{{ publication.text }}</p>
                    </div>

                    <div class="engagement">

                        <div class="stats">
                            <!-- <i class="fa fa-heart"></i> -->
                        </div>

                        <div class="actions">
                            {% if publication in liked_publications %}
                                <form class="like" action="{% url 'unlike' pk=publication.pk %}" method="get">
                                    <input type="hidden" name="pub_id" value="{{ publication.pk }}">
                                    <button><i class="fa-solid fa-heart"></i> Unlike</button>
                                </form>

                                <button class="comment-btn"><i class="fa-solid fa-comment"></i> comment</button>
                            {% else %}
                                <form class="like" action="{% url 'like' pk=publication.pk %}" method="get">
                                    <input type="hidden" name="pub_id" value="{{ publication.pk }}">
                                    <button><i class="far fa-heart"></i> Like</button>
                                </form>

                                <button class="comment-btn"><i class="fa-solid fa-comment"></i> comment</button>
                            {% endif %}
                        </div>
                        {% if publication.comment_set.exists %}
                            <ul class="comments">
                                {% for comment in publication.comment_set.all %}
                                    <li class="comment-li">
                                        <div class="comment-user">
                                            {% if comment.pet.petimage_set.first.image.url %}
                                                <div class="comment-user-img">
                                                    <img src="{{ comment.pet.petimage_set.first.image.url }}" alt="user image">
                                                </div>
                                            {% else %}
                                                <div class="comment-user-img"></div>
                                            {% endif %}
                                            <p><a href="{% url 'profile_details' pk=comment.pet.pk %}">{{ comment.pet.name }}</p></a>
                                        </div>
                                        <div class="comment-p">
                                            <p>{{ comment.comment }}</p>
                                            <input type="hidden" name="com_pk" id="com_pk" value="{{ comment.pk }}">
                                            <button class="reply"><i class="fa-solid fa-reply"></i> Reply</button>
                                        </div>
                                        <div class="replies">
                                            {% if comment.reply_set.all %}
                                                <ul>
                                                    {% for reply in comment.reply_set.all %}
                                                        <li>
                                                            <div class="reply-container">
                                                                <div class="reply-user-data">
                                                                    <div>
                                                                        {% if reply.pet.petimage_set.first.image.url %}
                                                                            <div class="reply-user-img">
                                                                                <img src="{{ reply.pet.petimage_set.first.image.url }}" alt="user image">
                                                                            </div>
                                                                        {% else %}
                                                                            <div class="reply-user-img"></div>
                                                                        {% endif %}
                                                                        <p><a href="{% url 'profile_details' pk=reply.pet.pk %}">{{ comment.pet.name }}</p></a>

                                                                        <div class="reply-p">
                                                                            <p>{{ reply.reply }}</p>
                                                                            <input type="hidden" name="rep_pk" id="rep_pk" value="{{ reply.pk }}">
                                                                            <button class="reply-reply"><i class="fa-solid fa-reply"></i> Reply</button>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                            {% if reply.replyreply_set.all %}
                                                                <ul>
                                                                    {% for reply_reply in reply.replyreply_set.all %}
                                                                        <li>
                                                                            <div class="reply-reply-container">
                                                                                <div class="reply-reply-user-data">
                                                                                    <input type="hidden" name="reply_reply_pk" value="{{ reply_reply.pk }}" id="reply_reply_pk">
                                                                                    {% if reply_reply.pet.petimage_set.first.image.url %}
                                                                                        <div class="reply-reply-user-img">
                                                                                            <img src="{{ reply_reply.pet.petimage_set.first.image.url }}" alt="user image">
                                                                                        </div>
                                                                                    {% else %}
                                                                                        <div class="reply-reply-user-img"></div>
                                                                                    {% endif %}
                                                                                    <p><a href="{% url 'profile_details' pk=reply_reply.pet.pk %}">{{ reply_reply.pet.name }}</p></a>
                                                                                    <p>{{ reply_reply.reply_reply }}</p>
                                                                                    <button class="reply-reply-reply-btn"><i class="fa-solid fa-reply"></i> Reply</button>
                                                                                </div>
                                                                            </div>
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            {% endif %}
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}

{% block extra_scripts %}
    <script>
        let CSRF_TOKEN = '{{ csrf_token }}';
    </script>

    <script src="{% static 'js/publication.js' %}"></script>
{% endblock %}